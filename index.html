<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Personal Feed üíú</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-gradient-start: #6b46c1;
            --bg-gradient-mid1: #9333ea;
            --bg-gradient-mid2: #c026d3;
            --bg-gradient-end: #db2777;
            --card-bg: rgba(255, 255, 255, 0.98);
            --card-border: rgba(192, 132, 252, 0.3);
            --header-bg: linear-gradient(135deg, rgba(243, 232, 255, 0.8), rgba(250, 232, 255, 0.8));
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
        }
        
        body.dark-mode {
            --bg-gradient-start: #0f0820;
            --bg-gradient-mid1: #1a0b3e;
            --bg-gradient-mid2: #2d1b69;
            --bg-gradient-end: #1a0b3e;
            --card-bg: rgba(30, 20, 60, 0.95);
            --card-border: rgba(147, 51, 234, 0.5);
            --header-bg: linear-gradient(135deg, rgba(30, 20, 60, 0.9), rgba(40, 25, 80, 0.9));
            --text-primary: #e9d5ff;
            --text-secondary: #c4b5fd;
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-mid1) 25%, var(--bg-gradient-mid2) 50%, var(--bg-gradient-end) 75%, var(--bg-gradient-mid1) 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            cursor: none;
            overflow-x: hidden;
            transition: all 0.5s ease;
        }
        
        body.dark-mode::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent),
                radial-gradient(1px 1px at 33% 80%, white, transparent),
                radial-gradient(1px 1px at 15% 50%, white, transparent);
            background-size: 200% 200%;
            animation: twinkle 3s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        /* INSTANT cursor - no lag! */
        .custom-cursor {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            font-size: 20px;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.8));
        }
        
        .star-trail {
            position: fixed;
            pointer-events: none;
            z-index: 9998;
            font-family: monospace;
            color: #fff;
            font-size: 14px;
            animation: starFade 0.8s ease-out forwards;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }
        
        @keyframes starFade {
            0% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: scale(0.5) rotate(180deg) translateY(20px);
            }
        }
        
        .particle {
            position: fixed;
            pointer-events: none;
            animation: float 4s ease-in-out infinite;
            z-index: 2;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
            50% { transform: translateY(-30px) rotate(180deg); opacity: 1; }
        }
        
        .post-card {
            transition: all 0.3s ease;
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(147, 51, 234, 0.2);
            border: 2px solid var(--card-border);
            position: relative;
            z-index: 10;
        }
        
        .post-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(147, 51, 234, 0.3);
            border-color: rgba(192, 132, 252, 0.6);
        }
        
        .post-header {
            padding: 12px 16px;
            background: var(--header-bg);
            border-bottom: 1px solid rgba(192, 132, 252, 0.2);
        }
        
        .post-content {
            padding: 0;
        }
        
        .post-actions {
            padding: 12px 16px;
            background: var(--header-bg);
            border-top: 1px solid rgba(192, 132, 252, 0.2);
        }
        
        .reactions-bar {
            padding: 8px 16px;
            background: var(--header-bg);
            border-top: 1px solid rgba(192, 132, 252, 0.15);
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }
        
        .reaction-btn {
            padding: 4px 8px;
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
            font-size: 16px;
        }
        
        .reaction-btn:hover {
            transform: scale(1.2);
            border-color: rgba(192, 132, 252, 0.4);
        }
        
        .reaction-btn.active {
            background: rgba(192, 132, 252, 0.2);
            border-color: rgba(192, 132, 252, 0.6);
        }
        
        .reply-section {
            padding: 12px 16px;
            background: var(--header-bg);
            border-top: 1px solid rgba(192, 132, 252, 0.15);
        }
        
        .reply-item {
            padding: 8px 12px;
            background: rgba(192, 132, 252, 0.1);
            border-radius: 12px;
            margin-bottom: 8px;
            border-left: 3px solid #a855f7;
        }
        
        .fade-in {
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(147, 51, 234, 0.3);
            z-index: 100;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(192, 132, 252, 0.4);
        }
        
        body.dark-mode .sync-indicator {
            background: rgba(30, 20, 60, 0.95);
            color: #e9d5ff;
        }
        
        /* Dark mode toggle button - clearly clickable! */
        .dark-mode-toggle {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .dark-mode-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 8px 25px rgba(147, 51, 234, 0.4);
        }
        
        .badge-tero {
            background: linear-gradient(135deg, #7c3aed, #a855f7);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.4);
            display: inline-block;
        }
        
        .badge-el {
            background: linear-gradient(135deg, #ec4899, #f472b6);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(236, 72, 153, 0.4);
            display: inline-block;
        }
        
        .collection-badge {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            margin-left: 6px;
        }
        
        /* Three-dot menu */
        .menu-dots {
            position: relative;
            cursor: pointer;
            padding: 4px 8px;
            transition: all 0.2s;
        }
        
        .menu-dots:hover {
            background: rgba(192, 132, 252, 0.2);
            border-radius: 8px;
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 2px solid rgba(192, 132, 252, 0.4);
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            min-width: 150px;
            z-index: 50;
            display: none;
            overflow: hidden;
        }
        
        body.dark-mode .dropdown-menu {
            background: rgba(30, 20, 60, 0.98);
            border-color: rgba(147, 51, 234, 0.6);
        }
        
        .dropdown-menu.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 10px 16px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .dropdown-item:hover {
            background: rgba(192, 132, 252, 0.2);
        }
        
        body.dark-mode .dropdown-item {
            color: #e9d5ff;
        }
        
        .btn-glow:hover {
            box-shadow: 0 0 25px rgba(192, 132, 252, 0.6), 0 0 50px rgba(192, 132, 252, 0.3);
            transform: scale(1.05);
        }
        
        .new-badge {
            background: linear-gradient(135deg, #ec4899, #f97316);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            margin-left: 6px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(236, 72, 153, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 20px 5px rgba(236, 72, 153, 0); }
        }
        
        ::-webkit-scrollbar {
            width: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(147, 51, 234, 0.1);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #a855f7, #ec4899);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #7c3aed, #db2777);
        }
        
        .post-note {
            padding: 12px 16px;
            background: linear-gradient(to right, rgba(168, 85, 247, 0.15), rgba(236, 72, 153, 0.15));
            border-left: 3px solid #a855f7;
            margin: 0;
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #9333ea, #c026d3);
            transition: all 0.3s ease;
        }
        
        .btn-purple:hover {
            background: linear-gradient(135deg, #7e22ce, #a21caf);
            box-shadow: 0 8px 25px rgba(147, 51, 234, 0.4);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(192, 132, 252, 0.5);
            position: relative;
            z-index: 1001;
        }
        
        body.dark-mode .modal-content {
            background: rgba(30, 20, 60, 0.98);
            color: #e9d5ff;
        }
        
        .collections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .collection-item {
            padding: 16px 12px;
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(236, 72, 153, 0.1));
            border: 2px solid rgba(192, 132, 252, 0.3);
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .collection-item:hover {
            transform: translateY(-4px);
            border-color: rgba(192, 132, 252, 0.6);
            box-shadow: 0 8px 20px rgba(147, 51, 234, 0.3);
        }
        
        .collection-item.active {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.3), rgba(236, 72, 153, 0.3));
            border-color: #a855f7;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="custom-cursor" id="cursor">‚ú¶</div>
    <div class="sync-indicator" id="syncStatus">üíú Connecting...</div>
    
    <div class="max-w-2xl mx-auto" style="position: relative; z-index: 10;">
        <div class="text-center mb-6 text-white">
            <div class="flex items-center justify-center gap-4 mb-3">
                <h1 class="text-6xl font-bold" style="text-shadow: 0 4px 20px rgba(147, 51, 234, 0.5);">Your Personal Feed üíú</h1>
                <button onclick="toggleDarkMode()" class="dark-mode-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">
                    <span id="darkModeIcon" class="text-2xl">üåô</span>
                </button>
            </div>
            <p class="text-xl opacity-95">Posts curated just for you ‚ú®</p>
        </div>

        <div class="flex justify-center gap-4 mb-6 flex-wrap">
            <button id="viewFeedBtn" class="px-8 py-3 rounded-full font-semibold shadow-lg transition-all bg-white text-purple-600 scale-105 btn-glow">
                üíú View Feed<span id="newCount" class="new-badge hidden">0</span>
            </button>
            <button id="addPostBtn" class="px-8 py-3 rounded-full font-semibold shadow-lg transition-all bg-white bg-opacity-20 text-white hover:bg-opacity-30 btn-glow border-2 border-white border-opacity-30">
                ‚ûï Add Post
            </button>
            <button onclick="openCollectionsModal()" class="px-8 py-3 rounded-full font-semibold shadow-lg transition-all bg-white bg-opacity-20 text-white hover:bg-opacity-30 btn-glow border-2 border-white border-opacity-30">
                üìÅ Collections
            </button>
        </div>

        <div id="filterButtons" class="flex justify-center gap-3 mb-8 flex-wrap">
            <button onclick="setFilter('new')" id="btnNew" class="px-6 py-2 rounded-full font-semibold transition-all bg-white text-purple-600 shadow-lg btn-glow text-sm">
                ‚ú® New
            </button>
            <button onclick="setFilter('seen')" id="btnSeen" class="px-6 py-2 rounded-full font-semibold transition-all bg-white bg-opacity-20 text-white hover:bg-opacity-30 btn-glow text-sm border-2 border-white border-opacity-30">
                üíú Seen
            </button>
            <button onclick="setFilter('all')" id="btnAll" class="px-6 py-2 rounded-full font-semibold transition-all bg-white bg-opacity-20 text-white hover:bg-opacity-30 btn-glow text-sm border-2 border-white border-opacity-30">
                üåü All Posts
            </button>
            <button onclick="markAllSeen()" id="btnMarkAll" class="px-6 py-2 rounded-full font-semibold transition-all bg-green-500 bg-opacity-80 text-white hover:bg-opacity-100 btn-glow text-sm hidden border-2 border-white border-opacity-30">
                ‚úì Mark All
            </button>
        </div>

        <div id="addSection" class="hidden bg-white rounded-3xl shadow-2xl p-8 mb-8 border-2 border-purple-300">
            <h2 class="text-3xl font-bold text-purple-900 mb-6">Add a New Post üíú</h2>
            <div class="space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-purple-900 mb-2">Who's posting? ‚ú®</label>
                    <select id="authorSelect" class="w-full px-5 py-3 border-2 border-purple-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition text-lg">
                        <option value="El">El üíñ</option>
                        <option value="Tero">Tero üíú</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-purple-900 mb-2">Post URL üîó</label>
                    <input type="url" id="postUrl" placeholder="https://..." class="w-full px-5 py-3 border-2 border-purple-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition text-lg">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-purple-900 mb-2">Collection (Optional) üìÅ</label>
                    <select id="collectionSelect" class="w-full px-5 py-3 border-2 border-purple-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition text-lg">
                        <option value="">No collection</option>
                        <option value="funny">üòÇ Funny</option>
                        <option value="cute">ü•∞ Cute</option>
                        <option value="news">üì∞ News</option>
                        <option value="inspiration">‚ú® Inspiration</option>
                        <option value="music">üéµ Music</option>
                        <option value="other">üìå Other</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-purple-900 mb-2">Your Note (Optional) üí≠</label>
                    <textarea id="postNote" placeholder="Why you thought they'd like this..." rows="4" class="w-full px-5 py-3 border-2 border-purple-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition text-lg"></textarea>
                </div>
                <button onclick="addPost()" class="w-full btn-purple text-white py-4 rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-2xl transform hover:scale-105">
                    ‚ú® Add to Feed üíú
                </button>
            </div>
        </div>

        <div id="feedSection" class="space-y-6">
            <div id="postsContainer" class="space-y-6"></div>
            <div id="emptyState" class="bg-white rounded-3xl shadow-2xl p-12 text-center border-2 border-purple-300">
                <div class="text-6xl mb-6">üíú</div>
                <h3 class="text-3xl font-bold text-purple-900 mb-3">No Posts Yet</h3>
                <p class="text-purple-700 text-lg mb-6">Start adding posts to create your personalized feed! ‚ú®</p>
                <button onclick="document.getElementById('addPostBtn').click()" class="px-8 py-3 btn-purple text-white rounded-full font-semibold transition transform hover:scale-105">
                    Add Your First Post üíú
                </button>
            </div>
        </div>
    </div>

    <!-- Collections Modal -->
    <div id="collectionsModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 text-purple-900">üìÅ Collections</h2>
            <p class="text-sm text-gray-600 mb-4">Filter posts by collection</p>
            <div class="collections-grid">
                <div class="collection-item" onclick="filterByCollection(null)">
                    <div class="text-2xl mb-1">üåü</div>
                    <div class="text-sm font-semibold">All</div>
                </div>
                <div class="collection-item" onclick="filterByCollection('funny')">
                    <div class="text-2xl mb-1">üòÇ</div>
                    <div class="text-sm font-semibold">Funny</div>
                </div>
                <div class="collection-item" onclick="filterByCollection('cute')">
                    <div class="text-2xl mb-1">ü•∞</div>
                    <div class="text-sm font-semibold">Cute</div>
                </div>
                <div class="collection-item" onclick="filterByCollection('news')">
                    <div class="text-2xl mb-1">üì∞</div>
                    <div class="text-sm font-semibold">News</div>
                </div>
                <div class="collection-item" onclick="filterByCollection('inspiration')">
                    <div class="text-2xl mb-1">‚ú®</div>
                    <div class="text-sm font-semibold">Inspire</div>
                </div>
                <div class="collection-item" onclick="filterByCollection('music')">
                    <div class="text-2xl mb-1">üéµ</div>
                    <div class="text-sm font-semibold">Music</div>
                </div>
                <div class="collection-item" onclick="filterByCollection('other')">
                    <div class="text-2xl mb-1">üìå</div>
                    <div class="text-sm font-semibold">Other</div>
                </div>
            </div>
            <button onclick="closeCollectionsModal()" class="w-full mt-6 px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-700 transition">
                Close
            </button>
        </div>
    </div>

    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getDatabase, ref, push, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBB0O3pcsHQt5mWVUFZqnbB0kY3Z9d8k304",
            authDomain: "personal-feed-149ce.firebaseapp.com",
            databaseURL: "https://personal-feed-149ce-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "personal-feed-149ce",
            storageBucket: "personal-feed-149ce.firebasestorage.app",
            messagingSenderId: "687986584760",
            appId: "1:687986584760:web:016afc08C44371f1985285"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const postsRef = ref(database, 'posts');

        let currentView = 'feed';
        let currentFilter = 'new';
        let currentCollection = null;
        let allPosts = {};
        let isDarkMode = false;

        // INSTANT cursor - no smoothing!
        const cursor = document.getElementById('cursor');
        
        const starChars = ['‚ú¶', '‚úß', '‚ãÜ', '‚úµ', '‚ú∂', '‚ú∑', '‚ú∏', '‚úπ', '*', '‚àó'];
        let trailCounter = 0;
        
        document.addEventListener('mousemove', (e) => {
            // Direct position - no lag!
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
            
            trailCounter++;
            if (trailCounter % 3 === 0) {
                createStarTrail(e.clientX, e.clientY);
            }
        });
        
        function createStarTrail(x, y) {
            const trail = document.createElement('div');
            trail.className = 'star-trail';
            trail.textContent = starChars[Math.floor(Math.random() * starChars.length)];
            trail.style.left = (x - 7) + 'px';
            trail.style.top = (y - 7) + 'px';
            
            const colors = ['#c084fc', '#e879f9', '#f0abfc', '#fae8ff', '#fff'];
            trail.style.color = colors[Math.floor(Math.random() * colors.length)];
            
            document.body.appendChild(trail);
            setTimeout(() => trail.remove(), 800);
        }
        
        function createParticles() {
            const purpleEmojis = ['üíú', '‚ú®', 'üí´', '‚≠ê', 'üåü', '‚ú¶', 'üîÆ', 'ü™ª'];
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = purpleEmojis[Math.floor(Math.random() * purpleEmojis.length)];
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.fontSize = Math.random() * 25 + 15 + 'px';
                particle.style.animationDelay = Math.random() * 4 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 4) + 's';
                document.body.appendChild(particle);
            }
        }
        createParticles();

        window.toggleDarkMode = function() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            document.getElementById('darkModeIcon').textContent = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('darkMode', isDarkMode);
        }
        
        if (localStorage.getItem('darkMode') === 'true') {
            toggleDarkMode();
        }

        function updateSyncStatus(status, color) {
            document.getElementById('syncStatus').textContent = status;
            document.getElementById('syncStatus').style.background = color;
        }

        onValue(postsRef, (snapshot) => {
            allPosts = snapshot.val() || {};
            loadPosts();
            updateNewCount();
            updateSyncStatus('üíú Synced', isDarkMode ? 'rgba(30, 20, 60, 0.95)' : 'rgba(216, 180, 254, 0.95)');
            setTimeout(() => updateSyncStatus('‚ú® Live', isDarkMode ? 'rgba(30, 20, 60, 0.95)' : 'rgba(255, 255, 255, 0.95)'), 2000);
        });

        function updateNewCount() {
            const newPosts = Object.values(allPosts).filter(p => !p.read).length;
            const badge = document.getElementById('newCount');
            const markAllBtn = document.getElementById('btnMarkAll');
            
            if (newPosts > 0) {
                badge.textContent = newPosts;
                badge.classList.remove('hidden');
                if (currentFilter === 'new') {
                    markAllBtn.classList.remove('hidden');
                }
            } else {
                badge.classList.add('hidden');
                markAllBtn.classList.add('hidden');
            }
        }

        document.getElementById('viewFeedBtn').addEventListener('click', () => {
            currentView = 'feed';
            updateView();
        });

        document.getElementById('addPostBtn').addEventListener('click', () => {
            currentView = 'add';
            updateView();
        });

        function updateView() {
            const addSection = document.getElementById('addSection');
            const feedSection = document.getElementById('feedSection');
            const filterButtons = document.getElementById('filterButtons');
            const viewBtn = document.getElementById('viewFeedBtn');
            const addBtn = document.getElementById('addPostBtn');

            if (currentView === 'add') {
                addSection.classList.remove('hidden');
                feedSection.classList.add('hidden');
                filterButtons.classList.add('hidden');
                addBtn.className = 'px-8 py-3 rounded-full font-semibold shadow-lg transition-all bg-white text-purple-600 scale-105 btn-glow';
                viewBtn.className = 'px-8 py-3 rounded-full font-semibold shadow-lg transition-all bg-white bg-opacity-20 text-white hover:bg-opacity-30 btn-glow border-2 border-white border-opacity-30';
            } else {
                addSection.classList.add('hidden');
                feedSection.classList.remove('hidden');
                filterButtons.classList.remove('hidden');
                viewBtn.className = 'px-8 py-3 rounded-full font-semibold shadow-lg transition-all bg-white text-purple-600 scale-105 btn-glow';
                addBtn.className = 'px-8 py-3 rounded-full font-semibold shadow-lg transition-all bg-white bg-opacity-20 text-white hover:bg-opacity-30 btn-glow border-2 border-white border-opacity-30';
            }
        }

        window.setFilter = function(filter) {
            currentFilter = filter;
            document.getElementById('btnNew').className = filter === 'new'
                ? 'px-6 py-2 rounded-full font-semibold transition-all bg-white text-purple-600 shadow-lg scale-105 btn-glow text-sm'
                : 'px-6 py-2 rounded-full font-semibold transition-all bg-white bg-opacity-20 text-white hover:bg-opacity-30 btn-glow text-sm border-2 border-white border-opacity-30';
            document.getElementById('btnSeen').className = filter === 'seen'
                ? 'px-6 py-2 rounded-full font-semibold transition-all bg-white text-purple-600 shadow-lg scale-105 btn-glow text-sm'
                : 'px-6 py-2 rounded-full font-semibold transition-all bg-white bg-opacity-20 text-white hover:bg-opacity-30 btn-glow text-sm border-2 border-white border-opacity-30';
            document.getElementById('btnAll').className = filter === 'all' 
                ? 'px-6 py-2 rounded-full font-semibold transition-all bg-white text-purple-600 shadow-lg scale-105 btn-glow text-sm'
                : 'px-6 py-2 rounded-full font-semibold transition-all bg-white bg-opacity-20 text-white hover:bg-opacity-30 btn-glow text-sm border-2 border-white border-opacity-30';
            
            updateNewCount();
            loadPosts();
        }

        window.markAllSeen = async function() {
            const updates = {};
            Object.entries(allPosts).forEach(([id, post]) => {
                if (!post.read) {
                    updates[`posts/${id}/read`] = true;
                }
            });
            await update(ref(database), updates);
            showToast('All posts marked as seen! üíú');
        }

        window.addPost = async function() {
            const url = document.getElementById('postUrl').value.trim();
            const note = document.getElementById('postNote').value.trim();
            const author = document.getElementById('authorSelect').value;
            const collection = document.getElementById('collectionSelect').value;

            if (!url) {
                alert('Please enter a URL');
                return;
            }

            try {
                await push(postsRef, {
                    url: url,
                    note: note,
                    author: author,
                    collection: collection,
                    timestamp: Date.now(),
                    read: false,
                    reactions: {},
                    replies: []
                });
                document.getElementById('postUrl').value = '';
                document.getElementById('postNote').value = '';
                document.getElementById('collectionSelect').value = '';
                currentView = 'feed';
                updateView();
                showToast('Post added! ‚ú®üíú');
            } catch (error) {
                alert('Failed to add post. Check your internet connection.');
            }
        }

        window.openCollectionsModal = function() {
            document.getElementById('collectionsModal').classList.add('show');
        }

        window.closeCollectionsModal = function() {
            document.getElementById('collectionsModal').classList.remove('show');
        }

        window.filterByCollection = function(collection) {
            currentCollection = collection;
            closeCollectionsModal();
            loadPosts();
            if (collection) {
                const collectionNames = {
                    funny: 'üòÇ Funny',
                    cute: 'ü•∞ Cute',
                    news: 'üì∞ News',
                    inspiration: '‚ú® Inspiration',
                    music: 'üéµ Music',
                    other: 'üìå Other'
                };
                showToast(`Filtering: ${collectionNames[collection]}`);
            } else {
                showToast('Showing all collections');
            }
        }

        // Three-dot menu functions
        window.toggleMenu = function(postId) {
            const menu = document.getElementById(`menu-${postId}`);
            // Close all other menus
            document.querySelectorAll('.dropdown-menu').forEach(m => {
                if (m.id !== `menu-${postId}`) m.classList.remove('show');
            });
            menu.classList.toggle('show');
        }

        window.changeCollection = async function(postId, collection) {
            await update(ref(database, `posts/${postId}`), { collection });
            const collectionNames = {
                '': 'None',
                funny: 'üòÇ Funny',
                cute: 'ü•∞ Cute',
                news: 'üì∞ News',
                inspiration: '‚ú® Inspiration',
                music: 'üéµ Music',
                other: 'üìå Other'
            };
            showToast(`Collection changed to: ${collectionNames[collection]}`);
            document.getElementById(`menu-${postId}`).classList.remove('show');
        }

        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.menu-dots')) {
                document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('show'));
            }
        });

        function loadPosts() {
            let posts = Object.entries(allPosts).map(([id, data]) => ({ id, ...data }))
                .sort((a, b) => b.timestamp - a.timestamp);

            if (currentFilter === 'new') posts = posts.filter(p => !p.read);
            if (currentFilter === 'seen') posts = posts.filter(p => p.read);
            if (currentCollection) posts = posts.filter(p => p.collection === currentCollection);

            const container = document.getElementById('postsContainer');
            const emptyState = document.getElementById('emptyState');

            if (posts.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                const h3 = emptyState.querySelector('h3');
                const p = emptyState.querySelector('p');
                if (currentFilter === 'new') {
                    h3.textContent = 'All Caught Up! ‚ú®';
                    p.textContent = 'No new posts to see. üíú';
                } else if (currentFilter === 'seen') {
                    h3.textContent = 'No Seen Posts';
                    p.textContent = 'Mark posts as seen and they\'ll appear here. üíú';
                } else {
                    h3.textContent = 'No Posts Yet';
                    p.textContent = 'Start adding posts! ‚ú®';
                }
                return;
            }

            emptyState.classList.add('hidden');
            container.innerHTML = posts.map(createPostCard).join('');
            setTimeout(() => window.twttr?.widgets?.load(), 100);
        }

        function getCollectionEmoji(collection) {
            const emojis = {
                funny: 'üòÇ',
                cute: 'ü•∞',
                news: 'üì∞',
                inspiration: '‚ú®',
                music: 'üéµ',
                other: 'üìå'
            };
            return emojis[collection] || '';
        }

        function getAuthorBadge(author) {
            const badgeClass = author === 'Tero' ? 'badge-tero' : 'badge-el';
            const emoji = author === 'Tero' ? 'üíú' : 'üíñ';
            return `<span class="${badgeClass}">${author} ${emoji}</span>`;
        }

        function createPostCard(post) {
            const date = new Date(post.timestamp).toLocaleDateString('en-US', {
                month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit'
            });
            const domain = post.url.match(/https?:\/\/([^\/]+)/)?.[1]?.replace('www.', '') || 'link';
            const tweetId = post.url.match(/(?:twitter|x)\.com\/.*\/status\/(\d+)/)?.[1];
            const author = post.author || 'Unknown';
            
            const reactions = post.reactions || {};
            const reactionEmojis = ['‚ù§Ô∏è', 'üòÇ', 'üòÆ', 'üòç', 'üî•', 'üëç'];
            
            const replies = post.replies || [];

            return `
                <div class="post-card fade-in">
                    <div class="post-header flex items-center justify-between">
                        <div class="flex items-center gap-2 text-xs" style="color: var(--text-secondary)">
                            ${getAuthorBadge(author)}
                            <span>‚Ä¢</span>
                            <span>${date}</span>
                            ${post.collection ? `<span class="collection-badge">${getCollectionEmoji(post.collection)}</span>` : ''}
                            ${post.read ? '<span class="px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full text-xs font-bold">üíú</span>' : ''}
                        </div>
                        <div class="flex items-center gap-2">
                            <!-- Three-dot menu -->
                            <div class="menu-dots" onclick="toggleMenu('${post.id}')">
                                <svg class="w-5 h-5" style="color: var(--text-secondary)" fill="currentColor" viewBox="0 0 24 24">
                                    <circle cx="12" cy="5" r="2"/>
                                    <circle cx="12" cy="12" r="2"/>
                                    <circle cx="12" cy="19" r="2"/>
                                </svg>
                                <div id="menu-${post.id}" class="dropdown-menu">
                                    <div class="dropdown-item" onclick="changeCollection('${post.id}', '')">üìå No Collection</div>
                                    <div class="dropdown-item" onclick="changeCollection('${post.id}', 'funny')">üòÇ Funny</div>
                                    <div class="dropdown-item" onclick="changeCollection('${post.id}', 'cute')">ü•∞ Cute</div>
                                    <div class="dropdown-item" onclick="changeCollection('${post.id}', 'news')">üì∞ News</div>
                                    <div class="dropdown-item" onclick="changeCollection('${post.id}', 'inspiration')">‚ú® Inspiration</div>
                                    <div class="dropdown-item" onclick="changeCollection('${post.id}', 'music')">üéµ Music</div>
                                    <div class="dropdown-item" onclick="changeCollection('${post.id}', 'other')">üìå Other</div>
                                </div>
                            </div>
                            <button onclick="deletePost('${post.id}')" class="text-purple-400 hover:text-red-500 transition">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    ${post.note ? `<div class="post-note">
                        <p class="text-sm italic" style="color: var(--text-primary)">"${post.note}"</p>
                    </div>` : ''}
                    
                    <div class="post-content">
                        ${tweetId ? `
                            <blockquote class="twitter-tweet" data-dnt="true" data-conversation="none">
                                <a href="https://twitter.com/x/status/${tweetId}"></a>
                            </blockquote>
                        ` : `
                            <div class="p-6 text-center">
                                <a href="${post.url}" target="_blank" class="text-purple-600 hover:text-purple-700 font-medium text-lg">
                                    üîó ${domain}
                                </a>
                            </div>
                        `}
                    </div>
                    
                    <div class="reactions-bar">
                        ${reactionEmojis.map(emoji => {
                            const count = reactions[emoji] || 0;
                            const isActive = count > 0;
                            return `<button class="reaction-btn ${isActive ? 'active' : ''}" onclick="toggleReaction('${post.id}', '${emoji}')">${emoji}${count > 0 ? ` ${count}` : ''}</button>`;
                        }).join('')}
                    </div>
                    
                    ${replies.length > 0 ? `
                        <div class="reply-section">
                            <div class="text-xs font-semibold mb-2" style="color: var(--text-secondary)">üí¨ Replies:</div>
                            ${replies.map(reply => `
                                <div class="reply-item">
                                    <div class="mb-1">${getAuthorBadge(reply.author)}</div>
                                    <div class="text-sm" style="color: var(--text-primary)">${reply.text}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="reply-section">
                        <input type="text" id="reply-${post.id}" placeholder="Add a reply... üí¨" class="w-full px-3 py-2 text-sm border-2 border-purple-300 rounded-lg mb-2" style="background: var(--card-bg); color: var(--text-primary)">
                        <button onclick="addReply('${post.id}')" class="w-full px-4 py-2 bg-purple-500 text-white rounded-lg text-sm font-semibold hover:bg-purple-600 transition">
                            üí¨ Reply
                        </button>
                    </div>
                    
                    <div class="post-actions flex gap-2">
                        <a href="${post.url}" target="_blank" class="flex-1 text-center btn-purple text-white px-4 py-2 rounded-lg text-sm font-semibold">
                            View Post ‚ú®
                        </a>
                        ${!post.read ? `<button onclick="markSeen('${post.id}')" class="px-4 py-2 bg-purple-500 text-white rounded-lg text-sm font-semibold hover:bg-purple-600 transition whitespace-nowrap">üíú Seen</button>` : ''}
                    </div>
                </div>
            `;
        }

        window.toggleReaction = async function(postId, emoji) {
            const post = allPosts[postId];
            const reactions = post.reactions || {};
            reactions[emoji] = (reactions[emoji] || 0) + 1;
            
            await update(ref(database, `posts/${postId}`), { reactions });
            showToast(`${emoji} reaction added!`);
        }

        window.addReply = async function(postId) {
            const input = document.getElementById(`reply-${postId}`);
            const text = input.value.trim();
            
            if (!text) {
                alert('Please enter a reply');
                return;
            }

            const author = 'El'; // You can make this dynamic
            
            const post = allPosts[postId];
            const replies = post.replies || [];
            replies.push({
                author,
                text,
                timestamp: Date.now()
            });
            
            await update(ref(database, `posts/${postId}`), { replies });
            input.value = '';
            showToast('Reply added! üí¨');
        }

        window.markSeen = async function(id) {
            await update(ref(database, `posts/${id}`), { read: true });
            showToast('Marked as seen! üíú');
        }

        window.deletePost = async function(id) {
            if (!confirm('Delete this post?')) return;
            await remove(ref(database, `posts/${id}`));
            showToast('Post deleted');
        }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-8 right-8 bg-purple-900 text-white px-8 py-4 rounded-2xl shadow-2xl z-50';
            toast.style.backdropFilter = 'blur(10px)';
            toast.style.border = '2px solid rgba(192, 132, 252, 0.5)';
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(20px)';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        }
    </script>
</body>
</html>
